Ок, вот ТЗ для Replit, чтобы проект из твоего репо maximelziv-max/replit нормально:
	•	редактировался в Replit,
	•	пушился в GitHub,
	•	и без проблем собирался/запускался в Timeweb.

Главная причина твоих ошибок в Timeweb сейчас: npm run build использует tsx, а Timeweb ставит только production-зависимости → tsx не устанавливается → tsx: not found.

⸻

ТЗ: “Replit → GitHub → Timeweb” совместимость

0) Цель

Сделать единый репозиторий GitHub, который:
	•	в Replit запускается командой npm run dev,
	•	в Timeweb запускается командами:
	•	Build: npm install && npm run build
	•	Start: npm run start
	•	не требует ручных правок и не падает в контейнере.

⸻

1) GitHub как источник

Требование

Replit должен быть подключён к GitHub репозиторию и работать через Commit/Push.

Критерии приёмки
	•	В Replit доступна панель Git (Version Control).
	•	Из Replit можно сделать Commit + Push в main.
	•	В GitHub появляется новый коммит.

⸻

2) Исправить зависимости для Timeweb (КРИТИЧНО)

Проблема

Timeweb при сборке делает npm ci --only=production, поэтому devDependencies не ставятся.

Требование

Перенести инструменты, которые используются в build, из devDependencies → в dependencies.

Обязательно:
	•	tsx → dependencies (потому что build = tsx script/build.ts)
	•	esbuild → dependencies (если используется в сборке)

Критерии приёмки

Команда должна работать:

npm ci --only=production && npm run build

Без ошибки tsx: not found.

⸻

3) Скрипты package.json (стандартизировать)

Требование

В package.json должны быть и работать следующие команды:
	•	dev: запуск разработки (Replit)
	•	build: сборка для production (Timeweb)
	•	start: запуск production

Рекомендуемый вариант (как у тебя, только обеспечить зависимости):

"scripts": {
  "dev": "NODE_ENV=development tsx server/index.ts",
  "build": "tsx script/build.ts",
  "start": "NODE_ENV=production node dist/index.cjs",
  "db:push": "drizzle-kit push"
}

Важно
	•	start не должен использовать pm2
	•	start должен держать процесс живым (не завершаться сразу)

⸻

4) Healthcheck endpoint (чтобы Timeweb не “рестартил”)

Требование

Добавить в server/index.ts быстрый ответ на /:

app.get("/", (_req, res) => res.status(200).send("OK"));

Вставить сразу после const app = express(); и до тяжёлых роутов.

Критерии приёмки
	•	GET / возвращает 200 OK без БД и без авторизации.
	•	Timeweb healthcheck проходит стабильно.

⸻

5) Порт и хост (обязательно для контейнера)

Требование

Сервер обязан слушать:
	•	host: "0.0.0.0"
	•	port: process.env.PORT

У тебя это уже сделано правильно — не ломать.

⸻

6) Переменные окружения

Требование

Добавить файл .env.example в репозиторий, чтобы было понятно, что нужно в Timeweb:

DATABASE_URL=postgresql://USER:PASSWORD@HOST:5432/DB_NAME
SESSION_SECRET=change_me_to_long_random_string
NODE_ENV=production

Критерии приёмки
	•	В README явно написано: “эти переменные нужно задать в Timeweb”.

⸻

7) Миграции БД (важно, чтобы деплой не ломался)

Требование

НЕ запускать db:push автоматически в build (иначе деплой упадёт, если БД недоступна).

Правильная политика:
	•	Build в Timeweb:
npm install && npm run build
	•	npm run db:push выполнять один раз вручную, когда база создана и DATABASE_URL задан.

(Если очень нужно автоматом — тогда только после 100% настроенной БД, но для MVP не рекомендую.)

⸻

8) README: инструкция для Timeweb

Добавить в README.md раздел “Deploy to Timeweb”:
	•	Тип: Node.js / Express
	•	Node: 20 (или 22)
	•	Build: npm install && npm run build
	•	Start: npm run start
	•	Env: DATABASE_URL, SESSION_SECRET, NODE_ENV
	•	Миграция: npm run db:push (один раз вручную)

⸻

Что тебе сделать прямо сейчас (самое важное)
	1.	В package.json перенести tsx (и при необходимости esbuild) в dependencies.
	2.	Добавить app.get("/") => OK в server/index.ts.
	3.	В Timeweb убрать pm2, Start = npm run start, Build = npm install && npm run build.
	4.	db:push запускать отдельно.

Если хочешь — я могу написать точный патч (готовые куски package.json, server/index.ts, .env.example, README.md) под твою текущую структуру, чтобы ты просто скопировал и закоммитил.