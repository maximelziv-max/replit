ТЗ ДЛЯ REPLIT: базовая авторизация (логин + пароль)

Цель

Добавить в MVP простую авторизацию:
	•	пользователь вводит логин (или email) + пароль
	•	если аккаунта нет — создаётся автоматически
	•	если есть — выполняется вход
	•	после входа пользователь попадает в Dashboard (список проектов)
	•	реализовать выход

Без усложнений: без email-верификации, без восстановления пароля, без 2FA.

⸻

1) Экраны

1.1 Страница /auth

Форма:
	•	поле login (placeholder: “Логин или email”)
	•	поле password (placeholder: “Пароль”)
	•	чекбокс/иконка “Показать пароль”
	•	кнопка Продолжить

Текст под формой:
	•	“Если аккаунта нет — мы создадим его автоматически.”

Поведение кнопки:
	•	отправляет POST /api/auth

⸻

1.2 Защищённые страницы

Все страницы заказчика (dashboard, создание проекта, просмотр проекта) должны быть доступны только если пользователь авторизован.
Если нет сессии → редирект на /auth.

⸻

1.3 Кнопка “Выйти”

В кабинете (dashboard) добавить кнопку Выйти:
	•	вызывает POST /api/logout
	•	чистит сессию
	•	редирект на /auth

⸻

2) Бизнес-логика авторизации

2.1 Правило “login or signup”

При нажатии “Продолжить”:
	1.	Проверяем: есть ли пользователь с таким login
	2.	Если нет → создаём пользователя
	•	сохраняем login
	•	сохраняем password_hash (bcrypt)
	3.	Если есть → проверяем пароль
	•	bcrypt compare
	4.	Если пароль неверен → ошибка “Неверный пароль”
	5.	Если ок → создаём сессию → redirect в dashboard

⸻

3) Валидации (минимум)
	•	login не пустой
	•	password минимум 6 символов
	•	login уникальный (unique)

Ошибки показывать текстом под полем/вверху:
	•	“Введите логин”
	•	“Пароль слишком короткий (минимум 6 символов)”
	•	“Неверный пароль”

⸻

4) Хранение данных (SQLite)

4.1 Таблица users

Поля:
	•	id (integer, PK)
	•	login (text, unique, not null)
	•	password_hash (text, not null)
	•	created_at (datetime)

⸻

5) Сессии

5.1 Cookie session

Использовать cookie-based сессию (например, express-session) или простой signed cookie.

Сессия должна хранить:
	•	user_id

5.2 Middleware

Создать middleware requireAuth:
	•	если нет user_id в сессии → redirect /auth

⸻

6) API endpoints

POST /api/auth

Вход/регистрация по правилу login or signup.

Request body:
	•	login
	•	password

Response:
	•	success → 200 + set-cookie + redirect
	•	fail → 400 + error message

⸻

POST /api/logout
	•	уничтожить сессию
	•	очистить cookie
	•	redirect /auth

⸻

7) Безопасность (минимально обязательно)
	•	хранить пароль только в виде bcrypt hash
	•	не логировать пароль в консоль
	•	включить httpOnly cookie
	•	(опционально) basic rate limit на /api/auth

⸻

8) Acceptance criteria (готовность)

Фича считается готовой, если:
	1.	Новый пользователь вводит login+password → аккаунт создаётся → открывается Dashboard
	2.	Существующий пользователь вводит правильный пароль → входит
	3.	Неверный пароль → появляется ошибка
	4.	Без входа нельзя открыть Dashboard / проекты
	5.	“Выйти” завершает сессию и возвращает на /auth

⸻

9) НЕ делать в рамках задачи
	•	email подтверждение
	•	восстановление пароля
	•	роли/команды
	•	OAuth