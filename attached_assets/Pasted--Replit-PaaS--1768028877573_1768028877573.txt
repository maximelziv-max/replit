ТЗ: Обновление запуска и сборки проекта для Replit и PaaS

Цель

Обеспечить стабильный запуск приложения в:
	•	Replit (dev-режим),
	•	Timeweb App Platform и аналогичных PaaS (prod-режим),

так, чтобы деплой выполнялся стандартными командами:
	•	npm install
	•	npm run build
	•	npm run start

без ручных костылей и без падений вида tsx: not found / рестартов контейнера.

⸻

Область работ

1) Исправить доступность tsx на стадии build

Проблема: npm run build использует tsx, но tsx находится в devDependencies. В окружениях, где dev-зависимости не ставятся, сборка падает.

Требование:
	•	Переместить пакет tsx из devDependencies в dependencies.

Файлы:
	•	package.json
	•	package-lock.json (обязательно обновить после изменения зависимостей)

Критерии приёмки:
	•	После npm ci --omit=dev команда npm run build НЕ падает.
	•	В логах сборки отсутствует ошибка tsx: not found.

⸻

2) Зафиксировать “универсальные” команды запуска (prod)

Состояние сейчас:
start = NODE_ENV=production node dist/index.cjs — это ок.

Требование:
	•	Оставить старт через node dist/index.cjs
	•	Убедиться, что build всегда создаёт dist/index.cjs (сейчас создаёт ✅)

Критерии приёмки:
	•	npm run build создаёт dist/index.cjs
	•	npm run start поднимает сервер и пишет в лог “serving on port …”
	•	Сервис слушает process.env.PORT и доступен извне

⸻

3) Replit: сохранить dev-запуск “как сейчас”

Состояние сейчас:
.replit запускает npm run dev, порт 5000, PORT=5000 — это правильно.

Требование:
	•	Не ломать npm run dev (tsx нужен и остаётся).
	•	Проверить, что Replit продолжает стартовать на 5000.

Критерии приёмки:
	•	В Replit по кнопке Run приложение стартует
	•	Порт 5000 открывается, веб-превью работает

⸻

4) (Опционально, но полезно) Указать engines Node.js

У тебя Replit на Node 20, Timeweb у тебя выбран Node 24.

Требование (рекомендация):
	•	Добавить в package.json:
	•	"engines": { "node": ">=20" }

Критерии приёмки:
	•	Проект корректно работает на Node 20+.

⸻

Изменения (коротко, “что сделать”)
	1.	package.json: перенести tsx из devDependencies → dependencies.
	2.	Выполнить npm install локально, чтобы обновился package-lock.json.
	3.	Запушить оба файла.
	4.	В Timeweb оставить команды:
	•	Build: npm install && npm run build
	•	Start: npm run start

⸻

Проверки после внедрения
	1.	Локально/в CI:
	•	npm ci --omit=dev
	•	npm run build ✅
	•	npm run start ✅
	2.	В Timeweb:
	•	Build проходит
	•	Контейнер не уходит в рестарт
	•	Вкладка “Сеть” показывает URL и он открывается